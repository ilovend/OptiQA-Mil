# 图像分割学习笔记 — 框架

说明：本文件为学习图像分割技术的笔记框架，后续在对应小节补充要点、示例、习题与心得。

## 目录
- [图像分割概述](#图像分割概述)
- [传统图像分割方法](#传统图像分割方法)
- [语义分割](#语义分割)
- [实例分割](#实例分割)
- [全景分割](#全景分割)
- [分割网络架构](#分割网络架构)
- [损失函数设计](#损失函数设计)
- [评价指标](#评价指标)
- [数据集与标注](#数据集与标注)
- [分割模型优化](#分割模型优化)
- [部署与加速](#部署与加速)
- [工业应用](#工业应用)
- [学习资源与书签](#学习资源与书签)
- [学习进度与 TODO 列表](#学习进度与-todo-列表)

---

## 图像分割概述
- 图像分割的定义与分类
- 像素级别的视觉理解
- 分割任务与其他视觉任务的关系
- 工业应用中的分割需求
- 研究前沿与趋势
- 示例：
```python
# 图像分割类型与可视化示例
import numpy as np
import matplotlib.pyplot as plt
from skimage import data
from skimage.segmentation import slic, mark_boundaries
from skimage.color import label2rgb
from skimage.future import graph
from skimage.measure import label, regionprops

# 设置画布
plt.figure(figsize=(15, 10))

# 1. 加载示例图像
image = data.astronaut()
plt.subplot(2, 3, 1)
plt.imshow(image)
plt.title('原始图像')
plt.axis('off')

# 2. 超像素分割 (传统分割方法示例)
segments = slic(image, n_segments=100, compactness=10)
superpixel_img = mark_boundaries(image, segments)
plt.subplot(2, 3, 2)
plt.imshow(superpixel_img)
plt.title('超像素分割 (SLIC)')
plt.axis('off')

# 3. 模拟语义分割结果
# 创建一个简化的语义分割掩码
semantic_mask = np.zeros(image.shape[:2], dtype=np.int32)
# 模拟背景(0)、人物(1)、宇航服(2)的语义标签
semantic_mask[50:350, 150:300] = 1  # 人物区域
semantic_mask[100:300, 170:270] = 2  # 宇航服区域

# 可视化语义分割结果
colors = np.array([[0, 0, 0], [0, 0, 1], [1, 0, 0]])  # 颜色映射：背景、人物、宇航服
semantic_img = label2rgb(semantic_mask, image=image, colors=colors, alpha=0.3, bg_label=0)
plt.subplot(2, 3, 3)
plt.imshow(semantic_img)
plt.title('语义分割')
plt.axis('off')

# 4. 模拟实例分割结果
# 创建几个实例区域
instance_mask = np.zeros(image.shape[:2], dtype=np.int32)
instance_mask[50:150, 150:250] = 1  # 实例1: 头部
instance_mask[150:250, 170:270] = 2  # 实例2: 躯干
instance_mask[250:350, 180:280] = 3  # 实例3: 手臂

# 可视化实例分割结果
instance_img = label2rgb(instance_mask, image=image, bg_label=0)
plt.subplot(2, 3, 4)
plt.imshow(instance_img)
plt.title('实例分割')
plt.axis('off')

# 5. 模拟全景分割结果 (语义 + 实例)
# 创建全景掩码
panoptic_mask = np.zeros(image.shape[:2], dtype=np.int32)
# 语义类别: 背景(0), 人物(1-99), 宇航服(100-199)
panoptic_mask[50:150, 150:250] = 1    # 实例1: 人物头部
panoptic_mask[150:250, 170:270] = 2   # 实例2: 人物躯干
panoptic_mask[250:350, 180:280] = 3   # 实例3: 人物手臂
panoptic_mask[100:170, 50:150] = 101  # 实例4: 宇航服部件1
panoptic_mask[200:300, 50:120] = 102  # 实例5: 宇航服部件2

# 可视化全景分割
panoptic_img = label2rgb(panoptic_mask, image=image, bg_label=0)
plt.subplot(2, 3, 5)
plt.imshow(panoptic_img)
plt.title('全景分割')
plt.axis('off')

# 6. 分割结果与原图对比
# 创建实例分割的轮廓叠加在原图上
labeled_regions = label(instance_mask)
props = regionprops(labeled_regions)

plt.subplot(2, 3, 6)
plt.imshow(image)
# 绘制每个区域的边界框和标签
for prop in props:
    y0, x0, y1, x1 = prop.bbox
    plt.text(x0, y0+20, f'实例{prop.label}', color='white', fontsize=10, 
             bbox=dict(facecolor='red', alpha=0.5))
    plt.plot([x0, x1, x1, x0, x0], [y0, y0, y1, y1, y0], 'r-', linewidth=2)
plt.title('分割结果叠加')
plt.axis('off')

plt.tight_layout()
plt.show()

# 分割在工业检测中的应用可视化
plt.figure(figsize=(12, 8))

# 模拟工业零件图像
part_image = np.ones((400, 600, 3)) * 0.8  # 浅灰色背景

# 添加"零件"形状
# 主体
part_image[100:300, 200:500, :] = [0.6, 0.6, 0.6]  # 灰色主体
# 孔洞
part_image[150:250, 250:350, :] = [0.8, 0.8, 0.8]  # 孔洞
# 添加"缺陷"
part_image[170:190, 400:450, :] = [0.3, 0.3, 0.3]  # 划痕
part_image[250:270, 300:320, :] = [0.2, 0.2, 0.2]  # 凹陷

# 显示原始图像
plt.subplot(2, 2, 1)
plt.imshow(part_image)
plt.title('模拟工业零件图像')
plt.axis('off')

# 模拟分割结果 - 零件主体
part_mask = np.zeros(part_image.shape[:2], dtype=np.int32)
part_mask[100:300, 200:500] = 1
part_mask[150:250, 250:350] = 0  # 孔洞不是零件的一部分

plt.subplot(2, 2, 2)
part_overlay = label2rgb(part_mask, image=part_image, bg_label=0, colors=[(0, 1, 0)])
plt.imshow(part_overlay)
plt.title('零件主体分割')
plt.axis('off')

# 模拟分割结果 - 缺陷检测
defect_mask = np.zeros(part_image.shape[:2], dtype=np.int32)
defect_mask[170:190, 400:450] = 1  # 划痕
defect_mask[250:270, 300:320] = 2  # 凹陷

plt.subplot(2, 2, 3)
defect_overlay = label2rgb(defect_mask, image=part_image, bg_label=0, 
                         colors=[(1, 0, 0), (1, 1, 0)])
plt.imshow(defect_overlay)
plt.title('缺陷分割')
plt.axis('off')

# 结合显示 - 工业检测结果
plt.subplot(2, 2, 4)
# 叠加零件和缺陷分割
combined_img = part_image.copy()
# 添加零件主体轮廓
part_boundary = mark_boundaries(combined_img, part_mask, color=(0, 1, 0), mode='thick')
# 高亮缺陷区域
for y in range(defect_mask.shape[0]):
    for x in range(defect_mask.shape[1]):
        if defect_mask[y, x] == 1:  # 划痕
            part_boundary[y, x] = [1, 0, 0]
        elif defect_mask[y, x] == 2:  # 凹陷
            part_boundary[y, x] = [1, 1, 0]

plt.imshow(part_boundary)
plt.title('工业检测结果')
# 添加标签说明
plt.text(400, 180, '划痕', color='red', fontsize=12)
plt.text(300, 260, '凹陷', color='yellow', fontsize=12)
plt.axis('off')

plt.tight_layout()
plt.show()
```
- 记录：
    - 分割技术类型比较：

## 传统图像分割方法
- 阈值分割技术
- 区域生长与分裂合并
- 边缘检测分割
- 分水岭算法
- 图论方法
- 记录：
    - 传统方法应用场景：

## 语义分割
- 语义分割定义与任务特点
- FCN全卷积网络
- DeepLab系列
- PSPNet与UNet
- 双向特征融合
- 记录：
    - 语义分割网络选择：

## 实例分割
- 实例分割与语义分割的区别
- Mask R-CNN架构
- SOLO与CondInst
- Bottom-up与Top-down方法
- 实例分割中的嵌入学习
- 记录：
    - 实例分割算法比较：

## 全景分割
- 全景分割的定义与挑战
- 语义与实例的统一
- Panoptic FPN
- 端到端全景分割
- 最新研究进展
- 记录：
    - 全景分割适用场景：

## 分割网络架构
- 编码器-解码器结构
- 多尺度特征融合
- 空洞卷积与感受野
- 注意力机制在分割中的应用
- Transformer在分割中的应用
- 记录：
    - 网络架构设计考量：

## 损失函数设计
- 交叉熵损失
- Dice损失
- Focal损失在分割中的应用
- 边界感知损失
- 多任务损失组合
- 记录：
    - 损失函数选择经验：

## 评价指标
- 像素准确率
- IoU与mIoU
- Dice系数
- 边界F1分数
- 工业应用中的评价指标
- 记录：
    - 评估指标选择依据：

## 数据集与标注
- 公开分割数据集
- 数据标注工具与流程
- 半自动标注方法
- 数据增强技术
- 标注质量控制
- 记录：
    - 数据集构建经验：

## 分割模型优化
- 轻量化分割网络
- 实时分割技术
- 半监督与弱监督分割
- 域适应方法
- 不平衡类别处理
- 记录：
    - 模型优化技巧：

## 部署与加速
- 模型压缩与量化
- TensorRT加速
- 移动端部署
- 边缘设备优化
- 实时分割系统架构
- 记录：
    - 部署实践经验：

## 工业应用
- 表面缺陷分割
- 工件尺寸测量
- 装配检验
- 材质与纹理分割
- 多模态融合分割
- 记录：
    - 应用案例分析：

## 学习资源与书签
- 经典论文与综述
- 代码实现与框架
- 教程与课程
- 竞赛与基准
- 记录：
    - 资源链接：

## 学习进度与 TODO 列表
- [ ] 分割基础理论学习
- [ ] 语义分割网络掌握
- [ ] 实例分割技术理解
- [ ] 分割模型优化实践
- [ ] 工业应用实施
- 自定义进度记录区：

---

备注：每个章节下可按"要点 / 代码示例 / 习题 / 参考链接 / 个人笔记"五小节结构补充内容。